# BigMart Sales Prediction

A full-stack machine learning web application that predicts outlet-level sales for BigMart products using a trained XGBoost model.

Built with:

* Flask
* Vanilla JavaScript
* Supabase (for live data persistence)

---

## Overview

The BigMart dataset contains sales data for **1,559 products across 10 outlets**.
The goal is to predict:

```bash
Item_Outlet_Sales
```

â€” the sales of each product in each store.

This app exposes the trained model through four interactive interfaces:

1. Standard prediction form
2. What-if simulator
3. Scenario comparator
4. Live analytics dashboard

All pages use:

* The same trained model
* The same encoding pipeline

---

## Model Performance

| Metric           | Value   |
| ---------------- | ------- |
| Algorithm        | XGBoost |
| RÂ² Score         | 0.5887  |
| MAE              | 787.76  |
| Training Records | 8,523   |

### Key Insight

**Outlet Type accounts for ~70% of total feature importance.**

Where a product is sold matters far more than what the product is.

* Switching from *Grocery Store* â†’ *Supermarket Type3* can shift predictions by â‚¹2,000+
* Changing Item Type or Visibility typically moves predictions by < â‚¹50

---

## Project Structure

```bash
bigmart/
â”œâ”€â”€ app.py
â”œâ”€â”€ best_model.pkl
â”œâ”€â”€ model_columns.pkl
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ predict.html
â”‚   â”œâ”€â”€ simulator.html
â”‚   â”œâ”€â”€ compare.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â””â”€â”€ insights.html
â”‚
â””â”€â”€ static/
    â”œâ”€â”€ css/
    â”‚   â”œâ”€â”€ style.css
    â”‚   â”œâ”€â”€ simulator.css
    â”‚   â”œâ”€â”€ compare.css
    â”‚   â”œâ”€â”€ dashboard.css
    â”‚   â””â”€â”€ insights.css
    â”‚
    â””â”€â”€ js/
        â”œâ”€â”€ main.js
        â”œâ”€â”€ predict.js
        â”œâ”€â”€ simulator.js
        â”œâ”€â”€ compare.js
        â”œâ”€â”€ dashboard.js
        â””â”€â”€ insights.js
```

---

## Pages

### `/` â€” Home

Landing page with project overview and entry point to the simulator.

### `/predict`

Standard form for entering item and outlet details.
Every submission saves predictions to Supabase.

### `/simulator`

Live what-if interface:

* Sliders for MRP, Weight, Visibility
* Dropdowns for categorical fields
* ~120ms debounced API prediction updates
* Sparkline (last 20 predictions)
* Delta indicator (shows prediction shift)

### `/compare`

Outlet comparison tool:

* Shared item fields
* Different outlet configurations
* Single `/api/compare` call
* Bar chart
* % difference
* Winner badge
* Diff table
* Business recommendation

### `/dashboard`

Live analytics via Supabase:

* Total predictions
* Average vs dataset average
* Highest prediction
* Top outlet type
* Timeline chart
* Outlet type bar chart
* Histogram
* Location doughnut
* MRP vs Sales scatter
* Recent predictions table

### `/insights`

Feature importance visualization from:

```python
model.feature_importances_
```

Includes:

* Grouped dummy features
* Horizontal bar chart
* Ranked list
* Business takeaways
* Model hyperparameters

---

## Setup

### Requirements

```bash
flask
joblib
numpy
pandas
scikit-learn
xgboost
supabase
```

Install:

```bash
pip install flask joblib numpy pandas scikit-learn xgboost supabase
```

---

### â–¶ Running Locally

```bash
python app.py
```

App runs at:

```bash
http://127.0.0.1:5000
```

---

## Supabase Configuration

Set credentials in either:

* Environment variables
* Directly in `app.py`

```python
SUPABASE_URL = "your_project_url"
SUPABASE_KEY = "your_anon_key"
```

Also update credentials in:

```bash
static/js/dashboard.js
```

---

### Expected Table Schema

```sql
create table public.bigmart_predictions (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  item_weight double precision,
  item_fat_content text,
  item_visibility double precision,
  item_type text,
  item_mrp double precision,
  outlet_identifier text,
  outlet_year bigint,
  outlet_size text,
  outlet_location text,
  outlet_type text,
  predicted_sales double precision,
  constraint bigmart_predictions_pkey primary key (id)
);
```

---

## ðŸ”¢ Encoding Strategy

The model was trained using **LabelEncoder** (not one-hot encoding).

`app.py` replicates the exact encoding used during training.

| Feature              | Encoding                                                       |
| -------------------- | -------------------------------------------------------------- |
| Item_Fat_Content     | Low Fat â†’ 0, Regular â†’ 1                                       |
| Outlet_Type          | Grocery Store â†’ 0, Supermarket Type1 â†’ 1, Type2 â†’ 2, Type3 â†’ 3 |
| Outlet_Size          | High â†’ 0, Medium â†’ 1, Small â†’ 2                                |
| Outlet_Location_Type | Tier 1 â†’ 0, Tier 2 â†’ 1, Tier 3 â†’ 2                             |
| Item_Type            | Alphabetical order (0â€“15)                                      |
| Outlet_Identifier    | Alphabetical order (OUT010â€“OUT049 â†’ 0â€“9)                       |

Input normalization guards handle dirty values:

* `LF` â†’ Low Fat
* `reg` â†’ Regular

Matching the preprocessing used during training.

---

## ðŸ”Œ API Routes

| Method | Route                     | Description                       |
| ------ | ------------------------- | --------------------------------- |
| GET    | `/`                       | Home page                         |
| GET    | `/predict`                | Prediction page                   |
| GET    | `/simulator`              | Simulator page                    |
| GET    | `/compare`                | Comparison page                   |
| GET    | `/dashboard`              | Analytics dashboard               |
| GET    | `/insights`               | Feature insights                  |
| POST   | `/api/predict`            | Single prediction + Supabase save |
| POST   | `/api/compare`            | Dual prediction                   |
| GET    | `/api/feature-importance` | Model feature importance          |

---

### `/api/predict` Request Body

```json
{
  "Item_Weight": 12.86,
  "Item_Fat_Content": "Low Fat",
  "Item_Visibility": 0.066,
  "Item_Type": "Dairy",
  "Item_MRP": 140.99,
  "Outlet_Identifier": "OUT049",
  "Outlet_Establishment_Year": 1999,
  "Outlet_Size": "Medium",
  "Outlet_Location_Type": "Tier 1",
  "Outlet_Type": "Supermarket Type1"
}
```

---

### `/api/compare` Request Body

```json
{
  "a": { ...same fields... },
  "b": { ...same fields with different outlet config... }
}
```

---

## Data Ranges

| Field           | Min     | Max      | Mean     |
| --------------- | ------- | -------- | -------- |
| Item MRP        | â‚¹31.29  | â‚¹266.89  | â‚¹140.99  |
| Item Weight     | 4.56 kg | 21.35 kg | 12.86 kg |
| Item Visibility | 0.000   | 0.328    | 0.066    |

Valid Outlet Establishment Years:

```bash
1985, 1987, 1997, 1998, 1999, 2002, 2004, 2007, 2009
```

---

## Feature Importance

| Feature                   | Importance |
| ------------------------- | ---------- |
| Outlet Type               | 70.8%      |
| Item MRP                  | 9.9%       |
| Outlet Establishment Year | 7.7%       |
| Outlet Location Type      | 1.9%       |
| Item Type                 | 1.9%       |
| Item Visibility           | 1.8%       |
| Outlet Size               | 1.6%       |
| Outlet Identifier         | 1.5%       |
| Item Fat Content          | 1.4%       |
| Item Weight               | 1.3%       |

### Interpretation

The dominance of **Outlet Type** is a property of the dataset.

Where a product is sold explains most of the variance in sales.
Product-level features have measurably smaller effects.